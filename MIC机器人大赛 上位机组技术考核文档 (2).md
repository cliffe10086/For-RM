# MIC校内机器人大赛 上位机组技术考核文档

<p align="right">version 1.0.0</p>

## 一、视觉解算方向
### 1.1 开发环境
#### 1.1.1 硬件环境
根据分配的主控（N3700或TX2），摄像头
#### 1.1.2 软件环境
Ubuntu22.04，ROS2 humble
### 1.2 代码规范
在ROS2框架中编写c++为主的代码，功能包的调用一定要清晰，涉及到的功能包都要放在一个工作空间内，通过不同的launch文件启动不同的功能，文件夹命名要求清晰明确，不要使用汉语拼音，使用英文单词+下划线+数字的组合方式命名，让自己和他人都能看懂。 
### 1.3 技术指标
#### 1.3.1 总体任务
完成视觉巡线整体架构的构建，以能够实现目标要求为准，巡线避障效果在功能正常的前提下再进行考核；
#### 1.3.2 具体要点
- 1.在ROS2中做具体图像处理、坐标变换、逻辑控制等操作。
- 2.调用相机，通过一定的代码优化保证相机帧率不会过低。通过不限于坐标变换等解算方法和其他控制算法来实现对车体控制不会过于粗糙。
- 3.安装opencv-c++版本。
- 4.使用opencv为主的方式进行目标检测。
- 5.通过相机回传图像实现对车体的控制，借助视觉巡线避障的方式进行车速和转角等车体控制。
- 6.可以与下位机进行通信，并正确控制下位机行动。
- 7.结合自己所学知识，完成机器人自动视觉巡线避障，通过视觉巡线区且不发生碰撞。
### 1.4 验收标准
按照以上具体要点进行验收。  
如果在运动中发生碰撞，但不对场地发生破坏行为、不造成人身安全问题完成视觉巡线区，也可以视作基本完成最后一点的要求。

## 二、深度学习方向
### 2.1 开发环境
#### 2.1.1 硬件环境
TX2，USB相机
#### 2.1.2 软件环境
- 载板端：Ubuntu22.04，CUDA+Cudnn，TensorRT，C++
- 训练端：任意系统环境，Anaconda+Python，CUDA（可选）
### 2.2 代码规范
训练端需确定使用的模型，并拉取相关模型的训练代码，注意保存训练所用的程序包、数据集。
载板端需要编写C++程序进行模型的部署，部署程序可以参考开源项目，但控制和通信部分需要自行编写，注意变量的命名规范，注释的编写，多文件使用，整体逻辑等代码基本规范。
### 2.3 技术指标
#### 2.3.1 总体任务
完成深度学习巡线、自主移动整体架构的构建，以能够实现目标要求为准，巡线避障效果在功能正常的前提下再进行考核。
#### 2.3.2 具体要点
- 1.在训练端安装Conda环境，并创建数据标注与模型训练的虚拟环境，如果有GPU资源可以选择配置CUDA环境。在载板端安装CUDA环境，Cudnn环境，TensorRT环境，C++编译及运行环境。
- 2.选择期望的视觉信息分析方式（如目标检测、实例分割、关键点检测等，选择一种适合比赛要求的分析方式），并根据选取的分析方式确定神经网络模型（如目标检测的YOLO，实例分割的UNet，关键点检测的RESNET等）。
- 3.进行数据集的采样，要求采集的数据和标注手段可以完成1中选择模型的训练（例如目标检测模型需要拍摄图像的同时为图像标注目标框构建数据集）
- 4.获取或自行编写模型训练代码，要求能够通过2中构建的数据集进行训练。
- 5.训练神经网络模型，通过各类指标分析模型效果，若模型效果差，则需要调整超参或清洗数据集，如仍无法解决模型效果差的问题需要换用其它模型或自行调整模型。
- 6.将模型进行转换，转换后的模型应该能够以最少一种方式在板端通过C++进行部署。
- 7.在板端通过C++部署训练后的模型，可以参考开源项目进行部署部分的编写。
- *8.修改部署部分的后处理的阶段，获取视觉分析结果，将结果映射为小车的控制逻辑，获取车速和转角的控制信息。
- 9.可以与下位机进行通信，并正确控制下位机行动。
- 10.结合自己所学知识，完成机器人自动视觉巡线避障，通过视觉巡线区且不发生碰撞。
### 2.4 验收标准
按照以上具体要点进行验收。  
如果在运动中发生碰撞，但不对场地发生破坏行为、不造成人身安全问题完成视觉巡线区，也可以视作基本完成最后一点的要求。

## 三、导航方向
### 3.1 开发环境
#### 3.1.1 硬件环境
N3700，雷达
#### 3.1.2 软件环境
Ubuntu22.04，ROS2 humble
### 3.2 代码规范
功能包的调用一定要清晰，涉及到的功能包都要放在一个工作空间内，通过不同的launch文件启动不同的功能，文件夹命名要求清晰明确，不要使用汉语拼音，使用英文单词+下划线+数字的组合方式命名，让自己和他人都能看懂。  
### 3.3 技术指标
#### 3.3.1 总体任务
完成导航整体架构的构建，以能够实现目标要求为准，建图效果和导航避障效果在功能正常的前提下再进行考核；
#### 3.3.2 具体要点
- 1.配置雷达驱动的功能包，启动雷达节点。
- 2.使用二维的建图算法完成二维地图的构建。
- 3.搭建navigation2的框架(安装方式不做要求)。
- 4.使用amcl或者cartographer等重定位算法做重定位。
- 5.通过在rviz2中给目标点的方式使小车向目标方向移动，且不能发生碰撞。
- 6.可以与下位机进行通信，并正确控制下位机行动。
- 7.结合自己所学知识，完成机器人自动导航控制，通过视觉巡线区且不发生碰撞。
### 3.4 验收标准
按照以上具体要点进行验收。  
如果在运动中发生碰撞，但不对场地发生破坏行为、不造成人身安全问题完成视觉巡线区，也可以视作基本完成最后一点的要求。

## 四、代码审查
各组队伍无论是否完成比赛，都应在赛后提交完整代码和功能包，主要针对代码内容进行检查，如有必要裁判组将会邀请参赛选手进行现场答辩。  
代码审查将对上位机组选手的招新产生重要影响，请大家尽力完成任务，如无法提交完整代码，有多少就交多少。

## 五、有关用时
通过巡线避障区的时间是考核成绩的标准之一，两名算法同学在一个队的情况下，需要分别对每名同学编写的算法进行测试。即：每名算法同学都需要用自己编写的代码控制小车自动地通过巡线避障区，身处同一个队的算法同学们需要将自己的小车两次分别用自己编写的代码来操控小车经过巡线避障区，作为算法组同学经过巡线避障区的用时部分的成绩。
例如：甲同学和乙同学同为算法组参加校内赛的同学，他们都在一个队，甲同学是视觉解算组，乙同学是导航组，则你们队伍的小车在记录成绩时可以分别用视觉和导航的方法通过巡线避障区，取最短用时作为你们队伍的成绩，但是小车两次通过视觉避障区的用时将分别作为你们的成绩。

## 五、特殊情况
待补充